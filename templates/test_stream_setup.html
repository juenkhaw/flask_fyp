{% extends "base.html" %}
{% block content %}
<script>
    function update_debug_option() {
        if($("#{{form.is_debug_mode.id}}").is(":checked")) {
            $("#debug_option").show();
        } else {
            $("#debug_option").hide();
            $("#{{form.debug_test_size.id}}").val(32);
        }
    }

    $(document).ready(function() {
        $("#{{form.full_model.id}}").val('');
        update_debug_option();

        $("#{{form.full_model.id}}").change(function() {
            var model = $("#{{form.full_model.id}}").val();
            $("form *").prop("disabled", true);
            $.ajax({
                url: "/test_stream",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({model: model}),
                success: function(response) {
                    //console.log(response);
                    $("#pkg_details").html(response.html);
                    $("#{{form.device.id}}").val(response.device);
                    $("#{{form.clip_len.id}}").val(response.clip_len);
                    $("#{{form.is_debug_mode.id}}").prop("checked", response.debug);
                    update_debug_option();
                    $("form *").prop("disabled", false);
                }
            });
        });

        $("#{{form.test_batch_size.id}}").change(function(){
            $.ajax({
                url: "/test_stream",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({batch: $(this).val()}),
                success: function(response) {
                }
            });
        });

        $("#{{form.is_debug_mode.id}}").change(function() {
            update_debug_option();
        });
    });
</script>
<style>
    
    form {
        width: 1050px;
        background-color: lightgray;
        margin: auto;
        text-align: center;
    }
	
	#pkg_details {
		text-align: center;
	}

    .details {
        height: 150px;
        overflow: auto;
		display: inline-block;
    }

    #args {
        margin-right: 20px;
    }

    table {
        border-collapse: collapse;
        border: 1px black solid;
    }

    td, th {
        border: 1px black solid;
        padding-right: 5px;
        padding-left: 5px;
        font-size: 14px;
    }

    .decimal {
        display: block;
        width: 80px;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
    }
	
	#args, #training {
		max-width: 50%;
	}
	
	fieldset fieldset {
		background: rgb(200,200,200);
	}
	
	form > fieldset:nth-child(odd) {
		background: rgb(220,220,220);
	}
	
	form > fieldset:nth-child(even) {
		background: rgb(180,180,180);
	}
	
	.hint {
		font-size: 14px;
		background: rgb(255, 244, 161);
		display: block;
		padding: 10px;
		width: 80%;
		margin: auto;
	}
	
	.warning {
		font-size: 14px;
		background: rgb(255, 208, 161);
		display: block;
		padding: 10px;
		width: 80%;
		margin: auto;
	}
	
</style>
<form action="" method="POST" novalidate>
    {{form.hidden_tag()}}
    <fieldset>
        <legend>Setup</legend>
		<p class="hint">
			Evaluate your models on test set with common methods: <b>10-clips and 10-crops</b>
		</p>
        <p>
            {{form.full_model.label}}<span style="color:red">*</span><br>
            {{form.full_model}} <br>
            {%for error in form.full_model.errors%}
            <span style="color: red;">[{{error}}]</span><br>
            {%endfor%}
        </p>
        <p>
            <label>Package Overview</label>
            <div id="pkg_details">
            <span style="color: red;">No data available</span>
        </div>
        </p>
        <p>
            {{form.device.label}}<span style="color:red">*</span><br>
            {{form.device}}
        </p>
        <p>
            {{form.test_method.label}}<span style="color:red">*</span><br>
            {{form.test_method}}<br>
        </p>
    </fieldset>
    <fieldset>
        <legend>Testing Batch</legend>
		<p class="warning">
			<b>BEWARE</b> that <b>10-clips</b> would generate <b>10 clips</b> 
			while <b>10-crops</b> would generate <b>100 clips</b>
			for each testing video respectively. Be sure not to flood your 
			device memory.
		</p>
        <p>
            {{form.clip_len.label}}<span style="color:red">*</span><br>
            {{form.clip_len(size=5)}}<br>
            {%for error in form.clip_len.errors%}
            <span style="color: red;">[{{error}}]</span><br>
            {%endfor%}
        </p>
        <p>
            {{form.test_batch_size.label}}<span style="color:red">*</span><br>
            {{form.test_batch_size(size=20)}}<br>

            {%for error in form.test_batch_size.errors%}
            <span style="color: red;">[{{error}}]</span><br>
            {%endfor%}
        </p>
        <p>
            {{form.test_subbatch_size.label}}<span style="color:red">*</span><br>
            {{form.test_subbatch_size(size=20)}}<br>

            {%for error in form.test_subbatch_size.errors%}
            <span style="color: red;">[{{error}}]</span><br>
            {%endfor%}
        </p>
    </fieldset>
    <fieldset>
        <legend>Debugging</legend>
		<p class="hint">
			Run on small batch of testing set before going on to full batch
		</p>
        <p>
            {{form.is_debug_mode}} {{form.is_debug_mode.label}}
        </p>
        <fieldset id="debug_option">
            <legend>Test Run on Small Batch</legend>
        <p>
            {{form.debug_mode.label}}<span style="color:red">*</span><br>
            {{form.debug_mode}}<br>
        </p>
        <p>
            {{form.debug_test_size.label}}<span style="color:red">*</span><br>
            {{form.debug_test_size(size=20)}}<br>
            {%for error in form.debug_test_size.errors%}
            <span style="color: red;">[{{error}}]</span><br>
            {%endfor%}
        </p>
        </fieldset>
    </fieldset>
    <p>{{form.submit}}</p>
    </form>
{% endblock %}